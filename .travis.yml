language: node_js
before_script:
  - npm install -g gatsby-cli
script:
  - yarn build
  - yarn es:check
  - yarn cy:test
  - yarn cp:cname
  - if [ "$TRAVIS_BRANCH" = "prd" ]; then yarn deploy && yarn deploy:coding; fi
cache:
  npm: true
  directories:
    - ~/.cache
    - ./cypress

after_script:
  - bash <(curl -s https://codecov.io/bash) -t $CODECOV_TOKEN > /dev/null
