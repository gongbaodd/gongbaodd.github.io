{"posts":[{"id":"2016/01/20/webpack-riot-loader.md","slug":"2016/01/20/webpack-riot-loader","body":"\n# webpack 里面使用 riot-loader\n\n```javascript\nvar webpack = require(\"webpack\");\nvar HtmlWebpackPlugin = require(\"html-webpack-plugin\");\nvar plugins = [\n  new webpack.ProvidePlugin({\n    riot: \"riot\",\n  }),\n  new webpack.HotModuleReplacementPlugin(),\n  new HtmlWebpackPlugin(),\n];\n\nmodule.exports = {\n  entry: \"./src/app\",\n  output: {\n    path: __dirname + \"/prd\",\n    filename: \"app.js\",\n  },\n  plugins: plugins,\n  module: {\n    preLoaders: [\n      {\n        test: /\\.tag$/,\n        loader: \"riotjs-loader\",\n        exclude: /node_modules/,\n        query: { type: \"none\" },\n      },\n    ],\n    loaders: [\n      {\n        test: /\\.js|\\.tag|\\.es6$/,\n        loader: \"babel-loader\",\n        exclude: /node_modules/,\n        query: {\n          presets: [\"es2015\"],\n        },\n      },\n      {\n        test: /\\.scss$/,\n        loaders: [\"style\", \"css?sourceMap\", \"sass?sourceMap\"],\n      },\n    ],\n  },\n  resolve: {\n    alias: {\n      yo: __dirname + \"/bower_components/Yo\",\n      zepto: __dirname + \"/bower_components/zepto/zepto.js\",\n      qrcode:\n        __dirname + \"/bower_components/qrcode/dist/arale-qrcode/3.0.5/index.js\",\n    },\n  },\n  devtool: \"source-map\",\n  devServer: {\n    contentBase: \"./prd\",\n    historyApiFallback: true,\n    hot: true,\n    inline: true,\n    progress: true,\n  },\n};\n```\n","collection":"blog","data":{"type":"post","category":"fe"}},{"id":"2016/01/22/jshint.md","slug":"2016/01/22/jshint","body":"\n# jshint 配置笔记\n\n```javascript\n{\n  \"undef\": true,\n  \"unused\": true,\n  \"curly\": true,\n  \"freeze\": true,\n  \"funcscope\": true,\n  \"nocomma\": true,\n  \"notypeof\": true,\n  \"shadow\": true,\n  \"debug\": true,\n  \"indent\": true,\n  \"predef\": [\n      \"require\",\n      \"document\",\n      \"window\",\n      \"QApp\",\n      \"module\",\n      \"setTimeout\",\n      \"setInterval\",\n      \"encodeURI\",\n      \"encodeURIComponent\"\n   ]\n}\n\n```\n","collection":"blog","data":{"type":"post","category":"fe"}},{"id":"2016/01/25/Fekit-es6-riot-tag.md","slug":"2016/01/25/fekit-es6-riot-tag","body":"\n# Fekit 支持 es6 和 riot 的 tag\n\n在如下目录里面添加 tag.js 和 es6.js\n\n```shell\n/usr/local/lib/node_modules/fekit/lib/compiler/plugins\n```\n\n```javascript\n// tag.js\n(function() {\n  var compiler = require(\"riot-compiler\");\n\n  exports.contentType = \"javascript\";\n\n  exports.process = function(txt, path, module, cb) {\n    try {\n      var prefix = 'var riot = require(\"riot\");\\n';\n      return cb(null, prefix + compiler.compile(txt));\n    } catch (err) {\n      return cb(err);\n    }\n  };\n})();\n```\n\n```javascript\n// es6.js\n(function() {\n  var babel;\n\n  babel = require(\"babel-core\");\n\n  exports.contentType = \"javascript\";\n\n  exports.process = function(txt, path, module, cb) {\n    try {\n      return cb(\n        null,\n        babel.transform(txt, {\n          presets: [\"es2015\"],\n        }).code\n      );\n    } catch (err) {\n      return cb(err);\n    }\n  };\n}.call(this));\n```\n","collection":"blog","data":{"type":"post","category":"fe"}},{"id":"2016/01/25/chrome.md","slug":"2016/01/25/chrome","body":"\n# chrome 插件开发笔记\n\n> [360 真是一个良心企业，这样不用翻墙就能看 API 了](http://open.chrome.360.cn/extension_dev/overview.html)\n\n# manifest.json\n\n```javascript\n{\n    \"name\": \"qunar schema qrcode\",\n    \"manifest_version\": 2,\n    \"version\": \"0.0.1\",\n    \"description\": \"generates qrcode\",\n    \"background\": {\n        \"scripts\": [\n            \"background.js\"\n        ]\n    },\n    \"page_action\": {\n        \"default_icon\": \"icon.png\",\n        \"default_title\": \"QunarQRCode\",\n        \"default_popup\": \"index.html\"\n    },\n    \"permissions\": [\n        \"http://*/\",\n        \"https://*/\",\n        \"tabs\"\n    ],\n    \"content_security_policy\": \"script-src 'self' 'unsafe-eval'; object-src 'self'\"\n}\n```\n\n# background.js 判断 url 并添加 page action\n\n```javascript\nfunction getDomainFromUrl(url) {\n  var a = document.createElement(\"a\");\n  a.href = url;\n  var o = a.origin;\n  setTimeout(function() {\n    a.remove();\n  }, 100);\n  return o.replace(a.protocol + \"//\", \"\");\n}\n\nfunction checkForValidUrl(tabId, changeInfo, tab) {\n  if (\n    getDomainFromUrl(tab.url)\n      .toLowerCase()\n      .indexOf(\"qunar\") > -1\n  ) {\n    chrome.pageAction.show(tabId);\n  }\n}\n\nchrome.tabs.onUpdated.addListener(checkForValidUrl);\n```\n\n# popup 里面获取本页 url\n\n```javascript\nchrome.tabs.getSelected(null, tab => {\n  callback(tab.url);\n});\n```\n","collection":"blog","data":{"type":"post","category":"fe"}},{"id":"2016/01/26/karma.md","slug":"2016/01/26/karma","body":"\n# 使用 karma 来做单元测试\n\n> 最近一直在搞 riot，想弄一个单测，正好官网提供了 karma 组件，搞起来吧\n\n# 安装\n\n```shell\ncnpm install --save-dev karma-riot\n```\n\n# 配置\n\n```javascript\n// karma.conf.js\nmodule.exports = function(config) {\n  config.set({\n    frameworks: [\"mocha\", \"riot\"],\n    plugins: [\n      \"karma-mocha\",\n      \"karma-mocha-reporter\",\n      \"karma-phantomjs-launcher\",\n      \"karma-riot\",\n    ],\n    files: [\"**/*.tag\", \"test/**/*.js\"],\n    preprocessors: {\n      \"**/*.tag\": [\"riot\"],\n    },\n    browsers: [\"PhantomJS\"],\n    reporters: [\"mocha\"],\n  });\n};\n```\n\n# 运行\n\n```shell\nkarma run\n```\n","collection":"blog","data":{"type":"post","category":"fe"}},{"id":"2016/01/27/commitment.md","slug":"2016/01/27/commitment","body":"\n# 写最正规的 commitment\n\n需要一个工具 Commitizen\n\n```shell\ncnpm install -g commitizen\n```\n\n在工程目录里面使用 angular 的 message 格式\n\n```shell\ncommitizen init cz-conventinl-changelog --save --save-exact\n```\n\n以后写 commit 的时候不用`git commit`改用`git cz`\n","collection":"blog","data":{"type":"post","category":"fe"}}]}