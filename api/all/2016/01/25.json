{"posts":[{"id":"2016/01/25/Fekit-es6-riot-tag.md","slug":"2016/01/25/fekit-es6-riot-tag","body":"\n# Fekit 支持 es6 和 riot 的 tag\n\n在如下目录里面添加 tag.js 和 es6.js\n\n```shell\n/usr/local/lib/node_modules/fekit/lib/compiler/plugins\n```\n\n```javascript\n// tag.js\n(function() {\n  var compiler = require(\"riot-compiler\");\n\n  exports.contentType = \"javascript\";\n\n  exports.process = function(txt, path, module, cb) {\n    try {\n      var prefix = 'var riot = require(\"riot\");\\n';\n      return cb(null, prefix + compiler.compile(txt));\n    } catch (err) {\n      return cb(err);\n    }\n  };\n})();\n```\n\n```javascript\n// es6.js\n(function() {\n  var babel;\n\n  babel = require(\"babel-core\");\n\n  exports.contentType = \"javascript\";\n\n  exports.process = function(txt, path, module, cb) {\n    try {\n      return cb(\n        null,\n        babel.transform(txt, {\n          presets: [\"es2015\"],\n        }).code\n      );\n    } catch (err) {\n      return cb(err);\n    }\n  };\n}.call(this));\n```\n","collection":"blog","data":{"type":"post","category":"fe"}},{"id":"2016/01/25/chrome.md","slug":"2016/01/25/chrome","body":"\n# chrome 插件开发笔记\n\n> [360 真是一个良心企业，这样不用翻墙就能看 API 了](http://open.chrome.360.cn/extension_dev/overview.html)\n\n# manifest.json\n\n```javascript\n{\n    \"name\": \"qunar schema qrcode\",\n    \"manifest_version\": 2,\n    \"version\": \"0.0.1\",\n    \"description\": \"generates qrcode\",\n    \"background\": {\n        \"scripts\": [\n            \"background.js\"\n        ]\n    },\n    \"page_action\": {\n        \"default_icon\": \"icon.png\",\n        \"default_title\": \"QunarQRCode\",\n        \"default_popup\": \"index.html\"\n    },\n    \"permissions\": [\n        \"http://*/\",\n        \"https://*/\",\n        \"tabs\"\n    ],\n    \"content_security_policy\": \"script-src 'self' 'unsafe-eval'; object-src 'self'\"\n}\n```\n\n# background.js 判断 url 并添加 page action\n\n```javascript\nfunction getDomainFromUrl(url) {\n  var a = document.createElement(\"a\");\n  a.href = url;\n  var o = a.origin;\n  setTimeout(function() {\n    a.remove();\n  }, 100);\n  return o.replace(a.protocol + \"//\", \"\");\n}\n\nfunction checkForValidUrl(tabId, changeInfo, tab) {\n  if (\n    getDomainFromUrl(tab.url)\n      .toLowerCase()\n      .indexOf(\"qunar\") > -1\n  ) {\n    chrome.pageAction.show(tabId);\n  }\n}\n\nchrome.tabs.onUpdated.addListener(checkForValidUrl);\n```\n\n# popup 里面获取本页 url\n\n```javascript\nchrome.tabs.getSelected(null, tab => {\n  callback(tab.url);\n});\n```\n","collection":"blog","data":{"type":"post","category":"fe"}}]}