{"posts":[{"id":"2019/04/01/XSS.md","slug":"2019/04/01/xss","body":"# Google 的 XSS 漏洞\r\n\r\n视频地址： [An actual XSS on google.com by Masato Kinugawa. ](https://youtu.be/lG7U3fuNw3A)\r\n\r\n## 简单的背景\r\n\r\n首先正常浏览器在控制台执行以下代码是会弹窗的，也就是说如果一个输入框输入了`<img src=\"\" onerror=\"alert(1)\"/>`，同时前端在回显的时候并没有处理它，页面就会弹窗。\r\n\r\n```javascript\r\nconst a = document.createElement('div');\r\na.innerHTML = '<img src=\"\" onerror=\"alert(1)\"/>';\r\n```\r\n\r\n很简单，只要把里面的标签都给替换成纯文字不就行了？问题又来了，如果我们需要的就是富文本呢？\r\n好在，现在已经有很多`sanitize`的包用来把可能注入代码的地方做转义处理了。\r\n\r\n## 在深入一点\r\n\r\n但是，假设用户输入的不是标准HTML呢？\r\n\r\n如果用户输入的是下面的代码\r\n\r\n```html\r\n<script><p title=\"</script>\">\r\n```\r\n\r\n浏览器会解析成两个节点\r\n\r\n```html\r\n<script><p title=\"</script>\r\n\"&gt;\r\n```\r\n\r\n如果换成DIV标签\r\n\r\n```html\r\n<div><p title=\"</div>\">\r\n```\r\n\r\n则会解析成一个节点\r\n\r\n```html\r\n<div><p title=\"</div>\"></p></div>\r\n```\r\n\r\nscript标签在执行innerHTML的时候并不解析，可见，浏览器对不同标签的处理是不同的，那么，干脆让浏览器来做标签标准化如何？借助template标签就可以。\r\n\r\n```javascript\r\nconst a = document.createElement('template');\r\na.innerHTML = '<div><p title=\"</div>\">';\r\nconsole.log(a.innerHTML); // 输出 <div><p title=\"</div>\"></p></div>\r\n```\r\n\r\n## 问题出现\r\n\r\n问题出现了，假设用户输入的是如下代码呢？\r\n\r\n```html\r\n<noscript><p title=\"</noscript><img src='' onerror='alert(1)'/>\">\r\n```\r\n\r\n在`template`的输出如下\r\n\r\n```html\r\n<noscript>\r\n    <p title=\"</noscript><img src='' onerror='alert(1)'/>\"></p>\r\n</noscript>\r\n```\r\n\r\n可浏览器的解析却如下\r\n\r\n```html\r\n<noscript>\r\n    <p title=\"\r\n</noscript>\r\n    <img src=\"\" onerror=\"alert(1)\">\r\n\"&gt;\r\n```\r\n\r\n怎么会这样？？？原因在于noscript是在不支持script的环境下作为script标签的兼容标签，在template环境下是不支持script的，此时noscript被解析了，而在开了script功能的浏览器却不解析noscript。\r\n\r\n## 修复\r\n\r\n这个问题很快就被Google回滚修复了，bug源于2月的一个功能性提交。","collection":"blog","data":{"type":"post","category":"fe"}},{"id":"2019/04/05/Go-to-Changsha-and-not-eat-Changsha-stinky-tofu,-but-also-look-at-the-coffin-of-Ma-Wangdui.md","slug":"2019/04/05/go-to-changsha-and-not-eat-changsha-stinky-tofu-but-also-look-at-the-coffin-of-ma-wangdui","body":"\n# 去长沙没吃到长沙臭豆腐但也要看看马王堆的棺材\n","collection":"blog","data":{"type":"post","category":"travel"}},{"id":"2019/04/07/Xiangjiang-does-not-have-a-fight-for-a-hundred-stringers,-there-is-a-Han-tomb.md","slug":"2019/04/07/xiangjiang-does-not-have-a-fight-for-a-hundred-stringers-there-is-a-han-tomb","body":"\n# 湘江没有百舸争流，倒有汉墓一座\n\n清明三天假期，本来琢么去桂林的，可惜失策在广西竟然有 5 天假，没想到上班时对比香港人是二等公民，放假了和少数民族自治区比起来，也是二等公民 😂。\n\n深圳北去桂林和长沙都很容易，高铁三小时就到。高铁出了广东，山水就美起来了，可以放下手上的书，戴上耳机（高铁里面有小孩）。看看外面的风景，说实话当时刚进广东（确切说是深圳）的时候，就觉得为什么这里的山水看起来都有点营养不良。\n\n长沙高铁站和全国其它高铁站一样，有两个广场，在东广场乘坐地铁，西广场乘坐公交车。国家近几年的高铁八纵八横活动，真的让很多城市都多了高铁站，可是感觉高铁站缺了些特色，简单说照 n 年前，我会和各种火车站合影，但如今，各地高铁站的不同点可能就是那个名字了吧。\n\n照习惯，我会先乘坐公交，因为高铁站往往离市区比较远，如果坐地铁就错失了欣赏城市风景的机会。不过，长沙和郑州还是有点普通了，若不是中途经过湘江，我竟然看不出长沙这个城市和别的城市的不同。\n\n第一夜，我住在湖南大学这边，横跨湘江的有一座桥，貌似这是唯一的一座能够行人通过的桥，亦或是正值假期，所以桥上人流攒动。过了桥就是长沙的网红景点太平老街，全街都是排队买臭豆腐的，没错，臭味与歌声齐飞。\n\n在往东走不远，是黄兴广场，依然是人头攒动，依然是到处都在卖臭豆腐，在一个就是长沙的网红饮品【茶颜悦色】，看排队的样子也要等好一会儿。黄兴广场后面是坡子街，有一个火神庙，里面供着毛主席。。。没错，因为毛主席在这里吃过臭豆腐，长沙除了臭豆腐，还有小龙虾，龙虾馆也要排队等位很久。这就是我在长沙的第一夜，在各种网红景点被人群挤来挤去。\n\n回去的路上，看到有卖槟榔的，作为一个北方人甚是新鲜，可听说这是一级致癌物还以为被禁售了呢，不过最后我还是没买，网上那些口腔癌变的照片实在恐怖。\n\n## 湖南省博物馆\n\n第二天，虽然我一大早就到了湖南省博，但还是排上了长队，教训啊，倘若我没住在湖南大学那边，去省博起码不需要走那个桥。。。湖南省博对我来说，必须看的，肯定是马王堆汉墓和人面青铜鼎了，另外要能看到湘西赶尸的介绍也不错哈 😄。\n\n排了一个小时的队，我已经是饥肠辘辘，赶紧去顶楼餐厅看看有什么，湖南省博进去之后只能从顶楼向下游览，因为整个建筑是参照马王堆汉墓建造的（可惜不是向下挖出来的，所以刚进来要坐电梯到 4 楼才能向下游览，而且我也没发现楼梯。。。）\n\n博物馆食堂早饭没什么特别的，就不多说了。从食堂坐电梯下一层就是马王堆墓葬展览。湘博的志愿者很多，不知道这和节日是不是有直接关系，再加上场馆内游客很多，观展体验其实不是那么好，好在碰到了个比较博学的讲解，即使环境恶劣也能听得比较认真 😂。\n\n马王堆汉墓，名字源于长沙的马王堆乡，这个汉墓其实和“马王“没有什么关系，这个马王是五代十国时期占据长沙的王，之所以叫做马王堆是因为这个地方本身山水较好，很多王陵在这里。而马王堆汉墓其实是汉初时期长沙王刘发的墓地，仔细算一算，应该是和刘胜是同一时期的人物！可以参考我之前去河北博物館（突然发现那一篇我沒写。。。）。当年的长沙国可占着大概整个湖南省的地方，最早的长沙王还不是刘发，而是帮助刘家守卫百越的...额，谁我忘了...说到百越，其实也不是春秋战国时期的越过，而是在趁秦末期战乱，率军从河北跑到岭南的赵佗将军。这个赵佗可是从秦一世一直熬过了秦朝两个皇帝，直到汉武帝刘彻才去世，熬死了 n 个中原皇帝，最短的年龄记录也有 102 岁，是至今最长寿的王了。\n\n扯得远了，汉初长沙王没有子嗣，于是长沙国君主给了马王堆的墓主人刘发，刘发到了长沙国后思念家乡，经常在西北一处高地去瞻望，那里就是长沙的定王台（长沙第二天我刚好住那里）。汉武帝时期削藩，长沙国自然也在内，但是因为长沙王帮助削闽南王有功，长沙国逃过一难，直到刘发儿子去世后才改长沙国为长沙郡。\n\n回到马王堆汉墓，汉墓保存的异常完整，博物馆里面有当时发掘的照片，藕片汤里面的藕片清晰可见完全没有被腐蚀。所以为什么这个墓保存这么好呢？其实走的地方多了就意识到，基本上西汉初期的墓室保存的都很好，源于文景之治，帝王限制国内奢侈风气，连皇帝的墓葬配置都极其清贫，陪葬的除了近身的物品也就是瓶瓶罐罐，奢侈点的东西都是拿木头或者陶器仿制的，所以盗墓的看到这样的墓室自然就躲开了，因为里面也没什么值钱的东西。\n\n汉墓里有三个墓室，最大的也是最早的是刘发的，其次是女主人的墓室，也就是马王堆女尸，最小的是刘发的儿子的墓。马王堆女主人确实比较苦命，根据计算，刘发在她二十多岁的时候就去世了，而她的儿子也走在她前面。女尸的棺椁覆盖三层，描述汉朝时期人们认为人死到升天的过程，大概和木乃伊的亡灵书类似，整个湘博最壮观的装置就是三层棺椁的投影了。\n\n看完棺椁，下楼就能看到女尸真貌，想看的童鞋还是要在网上先搜一下，绝对比网上恐怖...因为实在很真实。\n\n不多说了，湘博还有一个三湘传奇的展览，比较有趣的就是各种青铜器，比如人面青铜器。其实这花纹只是看起来像人，按照讲解来看，这可能是饕餮。\n\n## 岳麓书院\n\n从湘博出来坐车跨过湘江回到新文化路，距离岳麓书院就不远了，这附近是岳麓山，岳麓书院在岳麓山的脚下。从岳麓山入口到岳麓书院能路过湖南师范大学，也就是太祖的学校，和湖南大学，比较有趣的是湖南大学和湖南师范除了校门有标志，并没有一个明显的墙做分界，走着走着就跨了两所学校。\n\n岳麓书院 50 一张票，入口其实在湖南大学的东方红广场后面，但是我是从出口进入的 😐，网上能够搞到导游词，对于我来说是倒的 🤣。\n","collection":"blog","data":{"type":"post","category":"travel"}},{"id":"2019/04/27/Windows.md","slug":"2019/04/27/windows","body":"# 为什么文泉驿微米黑在windows上面那么难看\r\n\r\n之前我吐槽过大部分win32应用使用的都是segeUI字体，对中文的fallback是宋体，并不是吐槽宋体不好看，不知道多少Mac用户曾经吐槽过自己没有宋体，可是宋体在屏幕里的显示真心不好，很多字只能看到收锋而看不清笔画。\r\n\r\n好在有NoMeiryoUI的存在，可以把字体都换成微软雅黑，可视微软雅黑并不好看，也许是我本身弱视的缘故，微软雅黑每个汉字的结构体类似导致我不仔细看基本上看不清楚。相比之下，我就怀念起来在linux下面很常用的文泉驿微米黑。\r\n\r\n其实文泉驿微米黑也有很多缺点，比如同字号的微软雅黑就比文泉驿微米黑大，但是因为字形不像微软雅黑那么工整，反倒有利于我阅读。而且因为沿用Droid font风格，字体看起来又有一些俏皮。\r\n\r\n可是在windows上面用起来却出现了些问题，有部分笔画竟然有粗有细，在linux和mac上面的表现完全不同。查了资料，我在之乎上面找到了答案（原谅我没有贴链接，在火车上呢）。Windows为了解决老显示器分辨率的问题，在中文字体上面做了处理，比如在结构密集的字上细化它的笔画，甚至是减少笔画，这样在低分辨率上这些字不至于糊到一块，可这样就苦了高分屏幕的同志了。Mac就没有这个问题，因为人家字体刚用上的时候就是高分屏的时代了。\r\n\r\n其实这个容错处理在字体中可以设置，比如微软雅黑就有这个功能，可惜文泉驿还需要等。","collection":"blog","data":{"type":"post","category":"tech"}},{"id":"2019/04/30/The-feeling-of-staying-in-Kunming-is-the-most-comfortable-days-in-Beijing-in-spring.md","slug":"2019/04/30/the-feeling-of-staying-in-kunming-is-the-most-comfortable-days-in-beijing-in-spring","body":"\n# 待在昆明的感觉就是北京春天最舒服的那几天\n\n## 车上风景\n\n从深圳去昆明是有高铁的，路线是直接穿过广东、广西和贵州到达云南的「几」字形高速铁路。想要看风景的童鞋其实可以放弃了，基本上过了桂林就开始横穿横断山脉的各种山洞。然而桂林山川的确值得一看，火车会在短暂的几分钟时间里穿越桂林独特的山川，此时看着风景臆想一下火车在山峦中穿梭的情景也是不错的体验。\n\n## 昆明南高铁站\n\n昆明南高铁站周围很空，还没什么公交，只能坐地铁，大概一个小时才能到达昆明老城区（昆明火车站附近），我预定的青旅还要再转公交，但其实也可以扫个自行车，我也是这么做的。\n\n青旅距离翠湖公园其实有一点距离，躲在居民楼里面，是标准的赫鲁晓夫楼的样子，换好床铺我就前往附近的小吃街吃点东西。这小吃街也不错，虽然破破烂烂竟然有一家沃尔玛。\n","collection":"blog","data":{"type":"post","category":"travel"}}]}