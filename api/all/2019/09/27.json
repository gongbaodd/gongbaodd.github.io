{"posts":[{"id":"2019/09/27/jest.md","slug":"2019/09/27/jest","body":"# 总结一下最近 jest 上面的经验\n\n## mock localStorage\n\njsdom里面的localStorage是不能通过赋值覆盖的，但是有一个hack就是利用Object.defineProperty。\n\n```javascript\nObject.defineProperty(window, 'localStorage', {\n    writable: true,\n    value:{\n        getItem: jest.fn(),\n        setItem: jest.fn()\n    }\n});\n```\n\n## setTimeout\n\n有的时候需要让测试代码以为自己已经跑了一会儿。\n\n```javascript\njest.useFakeTimers();\n\njest.advanceTimersByTime();\n\njest.clearAllTimers();\n```\n\n## matchMedia\n\njsdom 还没提供，需要自己mock。\n\n```javascript\nwindow.matchMedia = jest.fn(query => ({\n    matches: false,\n    media: query,\n    onchange: null,\n    addListener: jest.fn(),\n    removeListener: jest.fn(),\n}));\n```","collection":"blog","data":{"type":"post","category":"fe"}}]}