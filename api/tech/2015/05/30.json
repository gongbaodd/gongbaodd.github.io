{"posts":[{"id":"2015/05/30/Climbing-Blue-Harm-Network.md","slug":"2015/05/30/climbing-blue-harm-network","body":"\n#爬蓝调口琴网\n>论文写好了就没事干了，本来想去旅游，完蛋流量没了，所以静下心来学学口琴，网上有个蓝调口琴网挺好哒，想写个应用装手机里，先讲讲怎么爬吧。\n\n主要还是用了request模块，然而由于网站用的是GBK编码，还需要iconv-lite、bufferhelper。\n\n    function get(url,callone,calltwo){\n        var req = request(url, {timeout: 10000, pool: false});\n        req.on('error', function(err) {\n            console.log(err);\n        });\n        req.on('response', function(res) {\n            var bufferHelper = new BufferHelper();\n            res.on('data', function (chunk) {\n                bufferHelper.concat(chunk);\n            });\n            res.on('end',function(){\n                var result = iconv.decode(bufferHelper.toBuffer(),'GBK');\n                callone(result,calltwo);\n            });\n        });\n    }\n    \n爬到了网页，用jquery来读里面的东西，用node-jquery就OK了\n\n    var env = require('jsdom').env;\n    env(html,function(err,window){\n        var $ = require('jquery')(window);\n    })\n    \n这个脚本用了特愚蠢的字符串拼json的方法。。。所以趁脚本结束前还得把json封闭了。\n\n    process.on('exit',function(){\n\t   fs.appendFileSync(FILE,'/b]}');\n    })","collection":"blog","data":{"type":"post","category":"tech"}}]}