{"posts":[{"id":"2020/04/13/threejs-fundamentals-threejs.md","slug":"2020/04/13/threejs-fundamentals-threejs","body":"\n# threejs fundamentals åå‰¯å…¶å®çš„ threejs å…¥é—¨ä¹¦\n\næœ€è¿‘å‡ å¤©çœŸæ˜¯å¿™ï¼Œé™¤äº†è¯»è¿™æœ¬ä¹¦ï¼Œæˆ‘çš„å¹³æ¿ï¼ˆé…·æ¯”é­”æ–¹ Mix Plusï¼‰çªç„¶è¿›ä¸å»ç³»ç»Ÿäº†ï¼ŒæŸ¥äº†ä¸€ä¸‹ï¼ŒåŸæ¥å±±å¯¨æœ¬ç¡¬ç›˜è´¨é‡ä¸å¥½ï¼Œè«åå…¶å¦™å…¨æ¸…äº†ï¼ˆæƒŠï¼ï¼‰ï¼Œå¥½åœ¨åšäº†å¤‡ä»½ï¼Œå½“ç„¶å› ä¸ºä¸æƒ³èŠ±é’±ï¼Œæ²¡å†ä¹°ä¸€ä¸ª SATA SSD ç¡¬ç›˜ï¼ŒèŠ±äº†ä¸€äº›æ—¶é—´é‡åšç³»ç»Ÿã€‚\n\nç¥¸ä¸å•è¡Œï¼Œä¸»åŠ›æœº Dell inspiron 13 é£æ‰‡åäº†ï¼Œè™½ç„¶å·²ç»æŠ¥ä¿®ï¼Œä½†è¿˜åœ¨èµ°æµç¨‹ï¼Œè¿™ä½¿å¾—æˆ‘ç°åœ¨åªèƒ½ä»¥ 1.8GHzï¼ˆå…³é—­é£æ‰‡ï¼‰ å·¥ä½œ ğŸ˜­ã€‚\n\næ­£å¥½ï¼Œåˆšåšå®Œç³»ç»Ÿï¼Œæ‰€ä»¥è¿™ç¯‡æ–‡ç« æˆ‘äº‰å–åœ¨å¹³æ¿ä¸Šå†™ï¼Œä»¥ä¿è¯ç³»ç»Ÿå®‰è£…æ­£ç¡®ã€‚\n\nå¦å¤–ï¼Œå› ä¸ºæŠ¢åˆ°äº†ç¦ç”°çš„æ¶ˆè´¹åˆ¸ï¼Œæ‰€ä»¥è¿™æœ¬ä¹¦çš„å®ç°ï¼Œäº‰å–åœ¨æœ¬å‘¨å®Œæˆã€‚\n","collection":"blog","data":{"type":"post","category":"book","tag":["threejs","JavaScript","webGL"]}},{"id":"2020/04/21/threejs-mesh.md","slug":"2020/04/21/threejs-mesh","body":"\n# threejs ç»†åŒ–-åˆ›å»ºä¸€ä¸ª meshã€ä½¿ç”¨åŠ è½½å™¨ã€å¤šä¸ªåœºæ™¯\n\nè®°å½•ä¸‹æœ€è¿‘å‡ å¤©çš„äº‹ï¼Œç»ˆäº Dell çš„ç»´ä¿®æŠŠæˆ‘ç”µè„‘çš„é£æ‰‡ä¿®å¥½äº†ï¼Œä¸è¿‡æ„Ÿè§‰ inspiron çš„é£æ‰‡è®¾è®¡æœ‰ bugï¼Œæ–°é£æ‰‡ä¼°è®¡ä¹Ÿæ’‘ä¸äº†å¤šä¹…ï¼Œä½†æ„¿åªæ˜¯æˆ‘å¤šç–‘äº†ã€‚å¦å¤–é€šè¿‡ç¥å¥‡çš„æŸå®ï¼Œæˆ‘å°†æˆ‘æ‰‹ä¸Šçš„å°ç±³å¹³æ¿äºŒå‡çº§äº†å†…å­˜å’Œç¡¬ç›˜ï¼Œè€ƒè™‘åˆ° 8GB å†…å­˜å¯¹äº Atom Z8500 è¿™ä¸ª CPU æœ‰ç‚¹å¤šä½™ï¼Œäºæ˜¯å‡çº§åˆ°äº† 4GB + 128GBï¼Œåˆ°æ‰‹ä¹‹åæœç„¶æ¯” 2GB æµç•…ï¼ˆå½“ç„¶è‚¯å®šæ²¡æ³•æ¯”é…·ç¿äº†ï¼‰ï¼Œæ‰€ä»¥è¿™ä¸ªé…ç½®è¿˜æ˜¯æ¯”è¾ƒæ¨èçš„ã€‚\n\nå›åˆ°ä¸»é¢˜ï¼Œæœ€è¿‘ä¸€å‘¨æˆ‘éƒ½åœ¨ä½¿ç”¨ react-three-fiber æ¥å­¦ä¹  threejsï¼Œè¿™é‡Œä¼šåšä¸€ä¸ªç³»åˆ—æ¥è¯¦ç»†æ•´ç†ä¸€ä¸‹ã€‚\n\n## åˆ›å»ºä¸€ä¸ª mesh\n\nå¯ä»¥ä½¿ç”¨ JSX åˆ›å»º mesh, å› ä¸º mesh æœ‰ material å’Œ geometry ä¸¤ä¸ªè®¿é—®å™¨ï¼Œåœ¨ JSX ä¸­å¯ä»¥ä½œä¸ºå±æ€§ä½¿ç”¨ã€‚\n\n```JavaScript\nexport default () => (\n    <Canvas>\n        <mesh\n            name=\"mesh\"\n            material={new MeshBasicMaterial()}\n            geometry={new BoxBufferGeometry(1, 1, 1)}\n        />\n    </Canvas>\n);\n```\n\nå½“ç„¶ä½œä¸ºå‚æ•°ä¹Ÿå¯ä»¥ã€‚\n\n```JavaScript\nexport default () => (\n    <Canvas>\n        <mesh arg={[new BoxBufferGeometry(1, 1, 1), new MeshBasicMaterial()]}/>\n    </Canvas>\n);\n```\n\nå®˜ç½‘è¿˜æä¾›äº†ä¸€ä¸ªç»å¦™çš„æ–¹æ³•ã€‚\n\n```JavaScript\n// å®ç°ä¸äº†ï¼Œä¸çŸ¥é“å’‹å›äº‹å„¿\nexport default () => (\n    <Canvas>\n        <mesh>\n            <boxBufferGeometry attach=\"geometry\" />\n            <meshBasicMaterial attach=\"material\" />\n        </mesh>\n    </Canvas>\n);\n```\n\nå¦å¤–å› ä¸º Canvas é‡Œé¢çš„å…ƒç´ å’Œ JSX çš„ç»‘å®šä½¿ç”¨çš„æ˜¯ memoï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨ primitive å®šä¹‰å…ƒç´ çš„æ—¶å€™ä¼šä¸¢ã€‚\n\n```JavaScript\n// è¿™ä¹ˆåšè™½ç„¶ä¼šæ¸²æŸ“å‡ºæ¥ï¼Œä½†æ˜¯Boxæœ‰çš„æ—¶å€™ä¼šä¸¢\nconst Box = new Mesh(\n    new BoxBufferGeometry(1, 1, 1),\n    new MeshBasicMaterial(),\n);\n\nexport default () => (\n    <Canvas>\n        <primitive object={Box} />\n    </Canvas>\n);\n```\n\n## åŠ è½½å™¨\n\nåŠ è½½ texture æ—¶ï¼Œå¯ä»¥ä½¿ç”¨`useEffect`è‡ªå·±å†™ï¼Œå½“ç„¶ä¹Ÿæœ‰æ›´ä¼˜é›…çš„æ–¹æ³•ï¼Œåˆ©ç”¨ react è‡ªå·±çš„`useMemo`æˆ–è€…`useCallback`ï¼Œå†å°±æ˜¯ä½¿ç”¨ react three fiber çš„`useLoader`ã€‚\n\n```JavaScript\n// ä½¿ç”¨ useMemo\nconst Plane = () => {\n    const texture = useMemo(() => new TextureLoader().load(\"xxx.jpg\"), [])\n    return <mesh\n        material={new MeshBasicMaterial({map: texture})}\n        geometry={new PlaneGeometry(1, 1)}\n    />\n}\n```\n\n```JavaScript\n// ä½¿ç”¨ useLoader\nconst PlaneAsync = () => {\n    const [texture] = useLoader(TextureLoader, \"xxx.jpg\");\n\n    return <mesh\n        material={new MeshBasicMaterial({map: texture})}\n        geometry={new PlaneGeometry(1, 1)}\n    />\n}\n\nconst Plane = () => (\n        <Suspense fallback={<mesh />}>\n            <PlaneAsync />\n        </Suspense>\n    )\n```\n\n## ä½¿ç”¨å¤šä¸ªåœºæ™¯\n\nthree react fiber ä¼šé»˜è®¤ç»™ä¸€ä¸ªåœºæ™¯(scene)ã€ä¸€ä¸ªæ‘„åƒå¤´(camera)è¿˜æœ‰ä¸€ä¸ªæ¸²æŸ“å™¨(render)ã€‚å¯æ˜¯å¦‚æœæˆ‘éœ€è¦å¤šä¸ªåœºæ™¯ï¼Œæ¯”å¦‚å»ºæ¨¡å·¥å…·å¾€å¾€ä¼šç»™ä¸€ä¸ªæ­£äº¤è§†å›¾ä»¥åŠæ­£è§†å›¾ï¼Œè¿™ç§æƒ…å†µå°±éœ€è¦å¤šä¸ªåœºæ™¯ã€‚\n\né¦–å…ˆè¦ä½¿ç”¨`setDefaultCamera`å°†æ–°å»ºçš„æ‘„åƒå¤´ä»£æ›¿é»˜è®¤æ‘„åƒå¤´ã€‚\n\n```TypeScript\nexport default () => {\n    const { setDefaultCamera } = useThree();\n    const camera = useRef<PerspectiveCamera>();\n\n    useLayoutEffect(() => camera.current && setDefaultCamera(camera.current), [])\n\n    return <perspectiveCamera\n      name=\"camera\"\n      ref={camera}\n    />\n}\n```\n\næ¥ä¸‹æ¥æ˜¯åˆ›å»ºåœºæ™¯ï¼Œåœºæ™¯ä¸éœ€è¦ä»£æ›¿åŸæœ‰åœºæ™¯ï¼Œä½†æ˜¯éœ€è¦ä½¿ç”¨`useFrame`ä¿®æ”¹`render`æ–¹æ³•ã€‚\n\n```TypeScript\n// å†åŸç”»é¢çš„å·¦ä¸Šè§’ç»˜åˆ¶åœºæ™¯\nexport default () => {\n    const scene = useRef<Scene>();\n    const {\n        size: {left, top, width, height},\n        camera,\n    } = useThree();\n\n    useFrame(({ gl }) => {\n        gl.autoClear = true;\n        gl.setScissor(left, top, width / 2, height / 2);\n        gl.setViewport(left, top, width / 2, height / 2);\n\n        scene.current && gl.render(scene, camera)\n    }, 10);\n\n    return (\n        <scene ref={scene}>\n            <mesh />\n        </scene>\n    );\n}\n```\n\nè¿™é‡Œ`useFrame`çš„ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºå®ƒçš„ä¼˜å…ˆçº§ï¼Œå€¼è¶Šé«˜ï¼Œè¶Šå…ˆæ¸²æŸ“ï¼Œè¿™æ„å‘³ç€æ¯”å®ƒä¼˜å…ˆçº§ä½çš„åœºæ™¯æ¸²æŸ“ä¹‹å‰è¦æŠŠ`gl.autoClear`è®¾ç½®ä¸º`false`ï¼Œä»¥é¿å…è¢«æ¸…é™¤ã€‚\n\n## å…¶å®ƒ\n\nå¦å¤–å¯ä»¥çœ‹çœ‹äº¬ä¸œçš„ä¸€ç¯‡åšå®¢[å‡¹å‡¸å®éªŒå®¤](https://aotu.io/notes/2018/10/18/cannonjs/index.html)ã€‚\n","collection":"blog","data":{"type":"post","category":"fe","tag":["threejs","JavaScript","webGL"],"series":{"slug":"threejs-howto","name":"ç»†å“threejs"}}}]}