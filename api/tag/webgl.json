{"posts":[{"id":"2020/03/22/react-three-fiber-WebGL.md","slug":"2020/03/22/react-three-fiber-webgl","body":"\n# ä½¿ç”¨ react-three-fiber ä½“éªŒç¾å¥½çš„ WebGL å¼€å‘\n\nä½¿ç”¨ threejs å¼€å‘ webGL åº”ç”¨åº”è¯¥æ˜¯å‡ ä¹æ¯ä¸ªå‰ç«¯å·¥ç¨‹å¸ˆæƒ³è¦åšçš„äº‹å„¿ï¼Œç„¶è€Œè™½ç„¶å¯¹æ¯”äºåŸç”Ÿ WebGL å¼€å‘æ¥è¯´ï¼Œthreejs å·²ç»åšäº†å¾ˆå¤šï¼Œä½†æ˜¯ç›¸å¯¹äºç°ä»£çš„ä¸€äº›å‰ç«¯æ¡†æ¶ã€‚threejs è¿˜ç¨æ˜¾ä¸è¶³ã€‚é’ˆå¯¹è¿™äº›ä¸è¶³ï¼Œå¾®è½¯å¼€å‘äº†[Babylon.js](https://www.babylonjs.com/)ï¼Œç»™ threejs é‡èº«å®šåˆ¶äº†ä¸€ä¸ªèŠ‚ç‚¹ç¼–è¾‘å™¨ï¼Œå¦‚æœåšè¿‡ blender æˆ–è€… unity çš„åŒå­¦ï¼Œå¯¹äºèŠ‚ç‚¹ç¼–è¾‘å™¨è‚¯å®šä¸ä¼šé™Œç”Ÿï¼Œä½†å¯¹æˆ‘æœ¬äººæ¥è¯´è¿˜æ˜¯æ²¡æœ‰è§¦ç¢°åˆ° G ç‚¹ã€‚\n\n## æè¿°ç»„ä»¶å…³ç³»çš„é‡è¦æ€§\n\næœ¬äººè§‰å¾—ï¼Œå¯¹äºå‰ç«¯å¼€å‘æ¥è¯´ï¼Œæä¾›ä¸€ä¸ªèƒ½å¤Ÿå‡†ç¡®æè¿°ç»„ä»¶å’Œç»„ä»¶ç»“æ„å…³ç³»çš„è¯­è¨€ï¼ˆDSLï¼‰æ˜¯è‡³å…³é‡è¦çš„ï¼Œå¦‚ HTML ä¹‹äº web å¼€å‘ï¼Œxml ä¹‹äºå®‰å“å¼€å‘ã€‚è¿™äº› DSL èƒ½å¤Ÿä»¥æœ€ç›´è§‚çš„æ–¹å¼è¡¨è¾¾é¡µé¢å°†ä¼šå±•ç¤ºä»€ä¹ˆï¼Œå°±ä»å¼€å‘çš„è§’åº¦ä¸Šæ¥è¯´ï¼Œæˆ–è®¸å…¥é—¨ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œæ¯•ç«Ÿè¦å¤„ç†å¾ˆå¤šæ–‡ä»¶ã€‚ä½†æ˜¯ç»´æŠ¤èµ·æ¥å´å¼‚å¸¸çš„è½»æ¾ï¼Œå°±æ˜¯å‰é¢æåˆ°çš„åŸå› ï¼Œç›´è§‚ã€‚å½“ç„¶å› ä¸º JavaScript è·Ÿ HTML çš„äº¤äº’æœ‰å¾ˆå¤§çš„æ€§èƒ½ç¼ºé™·ã€‚æ‰€ä»¥ç»™å¾ˆå¤šæ¨¡æ¿è¯­è¨€æä¾›äº†æœºä¼šã€‚æ¯”å¦‚ mustache è¿˜æœ‰ react çš„ JSXã€‚åœ¨å®‰å“ä¹Ÿèƒ½çœ‹åˆ° anko åœ¨ kotlin ç¤¾åŒºå…´èµ·ï¼Œä½†æ˜¯ä»…ä»…ä¸€å¹´å°±æ²¡æœ‰æ›´å¤šäººä½¿ç”¨äº†ï¼Œä¸ªäººä½“éªŒï¼Œåœ¨ Android studio ä¸­ä½¿ç”¨ xml å’Œ anko å¼€å‘ä½“éªŒå·®è·å¹¶ä¸å¤§ï¼Œæœ‰æ—¶å€™ xml ç”šè‡³å ä¼˜ï¼Œä¹Ÿè®¸è¿™å°±æ˜¯åŸå› ä¹‹ä¸€äº†å§ã€‚\n\nå‡ å¹´å‰æˆ‘ç¿»æŸ¥äº†å¾ˆå¤šæ¡†æ¶ï¼Œè€å®è¯´å¯èƒ½æ›´å¤šäººå¹¶æ²¡æœ‰æŠŠç»“æ„æè¿°æ”¾åœ¨å¦‚æˆ‘æƒ³çš„ä½ç½®ä¸Šï¼Œå“ªæ€•è¿ä¸ª JSON çš„æ–¹æ¡ˆéƒ½æ²¡æœ‰ã€‚ä½†æ˜¯çš„ç¡®æœ‰[aframejs](https://aframe.io/)è¿™ç§ç›´æ¥ç”¨ HTML ç®¡ç† canvas ä¸­å…ƒç´ å…³ç³»çš„åº“ï¼Œå¯æƒœå®ƒæ›´å…³æ³¨äº VR å¼€å‘ï¼Œè€Œæˆ‘æ›´å¸Œæœ› WebGL èƒ½å¤Ÿæˆä¸ºè¯¸å¦‚å›¾ä¹¦æ³¨è§£ä¸€æ ·çš„å·¥å…·ï¼Œå½“ç„¶è¿™ç§ä¸“æ³¨äºä¸€ä¸ªæ–¹é¢çš„åšæ³•æˆ–è®¸æ˜¯æ­£ç¡®çš„ï¼Œæ¯•ç«Ÿèƒ½å¤Ÿæ±‡èšä¸€ä¸ªå°åœˆçš„å¼€å‘è€…ï¼Œä¹Ÿä¸ä¼šæœ‰å¾ˆå¤šæµå¤±ã€‚\n\n## ç”¨ JSX å¼€å‘ WebGL\n\nä»Šå¹´è¿æ°”å°±å¥½å¤šäº†ï¼Œreact-reconciler ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿç›´æ¥æ¥ç®¡ç»„ä»¶çš„ render å‡½æ•°ï¼Œè€Œ react-hooks åœ¨å¼€å‘ä½“éªŒä¸Šå®Œç¾è¶…å‡ºç°æœ‰æ¡†æ¶ï¼Œ[react-babylonjs](https://github.com/brianzinn/react-babylonJS) å’Œ [react-three-fiber](https://github.com/react-spring/react-three-fiber) åº”è¿è€Œç”Ÿã€‚æˆ‘åŒæ—¶è¯•ç”¨äº†è¿™ä¸¤ä¸ªæ¡†æ¶ï¼Œç®€å•æ¥è¯´ï¼Œreact-three-fiber æ›´åŠ æˆç†Ÿäº›ï¼Œå¯¹ tTypeScript çš„æ”¯æŒæ›´å¥½ï¼Œè€Œ react-babylonjs å¼€å‘çš„æ—¶å€™å¾€å¾€ä¼šå› ä¸ºå¤„ç†ç±»å‹è€Œè´¹å¿ƒï¼Œæœ€ååˆä¸å¾—ä¸ä½¿ç”¨ JavaScript å¼€å‘ã€‚\n\n## æ€ä¹ˆä½¿ç”¨ react-three-fiber\n\nreact-three-fiber çš„[å®˜æ–¹æ–‡æ¡£é“¾æ¥](https://inspiring-wiles-b4ffe0.netlify.com/)æè¿°å¾ˆè¯¦ç»†ï¼Œå»ºè®®è¯¦è¯»ã€‚å¦å¤– threejs å®˜æ–¹æ¥é“¾æ¥çš„[threejs fundamentals](https://threejsfundamentals.org/)æœ‰æ—¶é—´ä¹Ÿå¯ä»¥æ‹¿æ¥è¯»è¯»ã€‚\n\nå¦‚æœæƒ³æŠŠåŸæ¥çš„ threejs æ¨¡å—è¿ç§»åˆ° react æ¨¡å—ï¼Œåªéœ€è¦ä½¿ç”¨ä¸€å±‚ primitive åŒ…è£…å³å¯ã€‚æ¯ä¸ªæ‹¥æœ‰ set å’Œ get çš„å‚æ•°éƒ½å¯ä»¥ä½œä¸º props çš„æˆå‘˜ï¼Œæ„é€ å™¨å‚æ•°åˆ™æ˜¯`props.args: any[]`ç±»å‹ã€‚\n\n```JavaScript\nconst grid = new GridHelper(2000, 20, 0x000000, 0x0000000);\n(grid.material as Material).opacity = 0.2;\n(grid.material as Material).transparent = true;\n\nconst Grid = () => {\n  useFrame(({ scene }) => {\n    if (!scene.fog) {\n      const fog = new Fog(0xa0a0a0, 200, 800);\n      scene.fog = fog;\n    }\n  });\n\n  return <primitive object={grid}></primitive>;\n};\n\n```\n\n## è°ƒè¯•å·¥å…·\n\nè¿™ç‚¹ babylonjs è¦å¥½å¾—å¤šï¼Œä¸€ä¸ªèŠ‚ç‚¹ç¼–è¾‘å™¨ç§’æ€ä¸€åˆ‡ï¼Œä½†æ˜¯ threejs è¿˜æœ‰ä¸€ä¸ªã€Œå¤Ÿç”¨ã€çš„[threejs inspector](https://chrome.google.com/webstore/detail/threejs-inspector/dnhjfclbfhcbcdfpjaeacomhbdfjbebi?hl=en)ã€‚\n\nä½¿ç”¨æ—¶éœ€è¦æŠŠä½ çš„ scene å’Œ THREE æ¨¡å—æš´éœ²ç»™ window ä½œç”¨åŸŸã€‚\n\n```JavaScript\nwindow.scene = scene;\nwindow.THREE = THREE;\n```\n\nç„¶ååˆ·æ–°æµè§ˆå™¨å°±å¯ä»¥åœ¨åœºæ™¯æ·»åŠ å…‰æºï¼ŒæŸ¥çœ‹èŠ‚ç‚¹ç­‰æ“ä½œäº†ã€‚\n\n## æç¤º\n\nå› ä¸º threejs åŠå…¶æ¨¡å—æœ¬èº«ä¸æ˜¯ç¼–è¯‘å¥½çš„ ES5ï¼Œåœ¨ nextjs ä¸­ä¸€å®šè®°å¾—ä½¿ç”¨`next-transpile-modules`ç¼–è¯‘ï¼Œå½“ç„¶å³ä½¿å·²ç»å®Œç¾é€‚é… ES5ï¼Œåœ¨ IE11 çš„å±•ç¤ºä¹Ÿä¸æ˜¯å¾ˆä¹è§‚ ğŸ˜…ã€‚\n","collection":"blog","data":{"type":"post","category":"fe","tag":["threejs","webGL","react"],"series":{"slug":"threejs-howto","name":"ç»†å“threejs"}}},{"id":"2020/04/13/threejs-fundamentals-threejs.md","slug":"2020/04/13/threejs-fundamentals-threejs","body":"\n# threejs fundamentals åå‰¯å…¶å®çš„ threejs å…¥é—¨ä¹¦\n\næœ€è¿‘å‡ å¤©çœŸæ˜¯å¿™ï¼Œé™¤äº†è¯»è¿™æœ¬ä¹¦ï¼Œæˆ‘çš„å¹³æ¿ï¼ˆé…·æ¯”é­”æ–¹ Mix Plusï¼‰çªç„¶è¿›ä¸å»ç³»ç»Ÿäº†ï¼ŒæŸ¥äº†ä¸€ä¸‹ï¼ŒåŸæ¥å±±å¯¨æœ¬ç¡¬ç›˜è´¨é‡ä¸å¥½ï¼Œè«åå…¶å¦™å…¨æ¸…äº†ï¼ˆæƒŠï¼ï¼‰ï¼Œå¥½åœ¨åšäº†å¤‡ä»½ï¼Œå½“ç„¶å› ä¸ºä¸æƒ³èŠ±é’±ï¼Œæ²¡å†ä¹°ä¸€ä¸ª SATA SSD ç¡¬ç›˜ï¼ŒèŠ±äº†ä¸€äº›æ—¶é—´é‡åšç³»ç»Ÿã€‚\n\nç¥¸ä¸å•è¡Œï¼Œä¸»åŠ›æœº Dell inspiron 13 é£æ‰‡åäº†ï¼Œè™½ç„¶å·²ç»æŠ¥ä¿®ï¼Œä½†è¿˜åœ¨èµ°æµç¨‹ï¼Œè¿™ä½¿å¾—æˆ‘ç°åœ¨åªèƒ½ä»¥ 1.8GHzï¼ˆå…³é—­é£æ‰‡ï¼‰ å·¥ä½œ ğŸ˜­ã€‚\n\næ­£å¥½ï¼Œåˆšåšå®Œç³»ç»Ÿï¼Œæ‰€ä»¥è¿™ç¯‡æ–‡ç« æˆ‘äº‰å–åœ¨å¹³æ¿ä¸Šå†™ï¼Œä»¥ä¿è¯ç³»ç»Ÿå®‰è£…æ­£ç¡®ã€‚\n\nå¦å¤–ï¼Œå› ä¸ºæŠ¢åˆ°äº†ç¦ç”°çš„æ¶ˆè´¹åˆ¸ï¼Œæ‰€ä»¥è¿™æœ¬ä¹¦çš„å®ç°ï¼Œäº‰å–åœ¨æœ¬å‘¨å®Œæˆã€‚\n","collection":"blog","data":{"type":"post","category":"book","tag":["threejs","JavaScript","webGL"]}},{"id":"2020/04/21/threejs-mesh.md","slug":"2020/04/21/threejs-mesh","body":"\n# threejs ç»†åŒ–-åˆ›å»ºä¸€ä¸ª meshã€ä½¿ç”¨åŠ è½½å™¨ã€å¤šä¸ªåœºæ™¯\n\nè®°å½•ä¸‹æœ€è¿‘å‡ å¤©çš„äº‹ï¼Œç»ˆäº Dell çš„ç»´ä¿®æŠŠæˆ‘ç”µè„‘çš„é£æ‰‡ä¿®å¥½äº†ï¼Œä¸è¿‡æ„Ÿè§‰ inspiron çš„é£æ‰‡è®¾è®¡æœ‰ bugï¼Œæ–°é£æ‰‡ä¼°è®¡ä¹Ÿæ’‘ä¸äº†å¤šä¹…ï¼Œä½†æ„¿åªæ˜¯æˆ‘å¤šç–‘äº†ã€‚å¦å¤–é€šè¿‡ç¥å¥‡çš„æŸå®ï¼Œæˆ‘å°†æˆ‘æ‰‹ä¸Šçš„å°ç±³å¹³æ¿äºŒå‡çº§äº†å†…å­˜å’Œç¡¬ç›˜ï¼Œè€ƒè™‘åˆ° 8GB å†…å­˜å¯¹äº Atom Z8500 è¿™ä¸ª CPU æœ‰ç‚¹å¤šä½™ï¼Œäºæ˜¯å‡çº§åˆ°äº† 4GB + 128GBï¼Œåˆ°æ‰‹ä¹‹åæœç„¶æ¯” 2GB æµç•…ï¼ˆå½“ç„¶è‚¯å®šæ²¡æ³•æ¯”é…·ç¿äº†ï¼‰ï¼Œæ‰€ä»¥è¿™ä¸ªé…ç½®è¿˜æ˜¯æ¯”è¾ƒæ¨èçš„ã€‚\n\nå›åˆ°ä¸»é¢˜ï¼Œæœ€è¿‘ä¸€å‘¨æˆ‘éƒ½åœ¨ä½¿ç”¨ react-three-fiber æ¥å­¦ä¹  threejsï¼Œè¿™é‡Œä¼šåšä¸€ä¸ªç³»åˆ—æ¥è¯¦ç»†æ•´ç†ä¸€ä¸‹ã€‚\n\n## åˆ›å»ºä¸€ä¸ª mesh\n\nå¯ä»¥ä½¿ç”¨ JSX åˆ›å»º mesh, å› ä¸º mesh æœ‰ material å’Œ geometry ä¸¤ä¸ªè®¿é—®å™¨ï¼Œåœ¨ JSX ä¸­å¯ä»¥ä½œä¸ºå±æ€§ä½¿ç”¨ã€‚\n\n```JavaScript\nexport default () => (\n    <Canvas>\n        <mesh\n            name=\"mesh\"\n            material={new MeshBasicMaterial()}\n            geometry={new BoxBufferGeometry(1, 1, 1)}\n        />\n    </Canvas>\n);\n```\n\nå½“ç„¶ä½œä¸ºå‚æ•°ä¹Ÿå¯ä»¥ã€‚\n\n```JavaScript\nexport default () => (\n    <Canvas>\n        <mesh arg={[new BoxBufferGeometry(1, 1, 1), new MeshBasicMaterial()]}/>\n    </Canvas>\n);\n```\n\nå®˜ç½‘è¿˜æä¾›äº†ä¸€ä¸ªç»å¦™çš„æ–¹æ³•ã€‚\n\n```JavaScript\n// å®ç°ä¸äº†ï¼Œä¸çŸ¥é“å’‹å›äº‹å„¿\nexport default () => (\n    <Canvas>\n        <mesh>\n            <boxBufferGeometry attach=\"geometry\" />\n            <meshBasicMaterial attach=\"material\" />\n        </mesh>\n    </Canvas>\n);\n```\n\nå¦å¤–å› ä¸º Canvas é‡Œé¢çš„å…ƒç´ å’Œ JSX çš„ç»‘å®šä½¿ç”¨çš„æ˜¯ memoï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨ primitive å®šä¹‰å…ƒç´ çš„æ—¶å€™ä¼šä¸¢ã€‚\n\n```JavaScript\n// è¿™ä¹ˆåšè™½ç„¶ä¼šæ¸²æŸ“å‡ºæ¥ï¼Œä½†æ˜¯Boxæœ‰çš„æ—¶å€™ä¼šä¸¢\nconst Box = new Mesh(\n    new BoxBufferGeometry(1, 1, 1),\n    new MeshBasicMaterial(),\n);\n\nexport default () => (\n    <Canvas>\n        <primitive object={Box} />\n    </Canvas>\n);\n```\n\n## åŠ è½½å™¨\n\nåŠ è½½ texture æ—¶ï¼Œå¯ä»¥ä½¿ç”¨`useEffect`è‡ªå·±å†™ï¼Œå½“ç„¶ä¹Ÿæœ‰æ›´ä¼˜é›…çš„æ–¹æ³•ï¼Œåˆ©ç”¨ react è‡ªå·±çš„`useMemo`æˆ–è€…`useCallback`ï¼Œå†å°±æ˜¯ä½¿ç”¨ react three fiber çš„`useLoader`ã€‚\n\n```JavaScript\n// ä½¿ç”¨ useMemo\nconst Plane = () => {\n    const texture = useMemo(() => new TextureLoader().load(\"xxx.jpg\"), [])\n    return <mesh\n        material={new MeshBasicMaterial({map: texture})}\n        geometry={new PlaneGeometry(1, 1)}\n    />\n}\n```\n\n```JavaScript\n// ä½¿ç”¨ useLoader\nconst PlaneAsync = () => {\n    const [texture] = useLoader(TextureLoader, \"xxx.jpg\");\n\n    return <mesh\n        material={new MeshBasicMaterial({map: texture})}\n        geometry={new PlaneGeometry(1, 1)}\n    />\n}\n\nconst Plane = () => (\n        <Suspense fallback={<mesh />}>\n            <PlaneAsync />\n        </Suspense>\n    )\n```\n\n## ä½¿ç”¨å¤šä¸ªåœºæ™¯\n\nthree react fiber ä¼šé»˜è®¤ç»™ä¸€ä¸ªåœºæ™¯(scene)ã€ä¸€ä¸ªæ‘„åƒå¤´(camera)è¿˜æœ‰ä¸€ä¸ªæ¸²æŸ“å™¨(render)ã€‚å¯æ˜¯å¦‚æœæˆ‘éœ€è¦å¤šä¸ªåœºæ™¯ï¼Œæ¯”å¦‚å»ºæ¨¡å·¥å…·å¾€å¾€ä¼šç»™ä¸€ä¸ªæ­£äº¤è§†å›¾ä»¥åŠæ­£è§†å›¾ï¼Œè¿™ç§æƒ…å†µå°±éœ€è¦å¤šä¸ªåœºæ™¯ã€‚\n\né¦–å…ˆè¦ä½¿ç”¨`setDefaultCamera`å°†æ–°å»ºçš„æ‘„åƒå¤´ä»£æ›¿é»˜è®¤æ‘„åƒå¤´ã€‚\n\n```TypeScript\nexport default () => {\n    const { setDefaultCamera } = useThree();\n    const camera = useRef<PerspectiveCamera>();\n\n    useLayoutEffect(() => camera.current && setDefaultCamera(camera.current), [])\n\n    return <perspectiveCamera\n      name=\"camera\"\n      ref={camera}\n    />\n}\n```\n\næ¥ä¸‹æ¥æ˜¯åˆ›å»ºåœºæ™¯ï¼Œåœºæ™¯ä¸éœ€è¦ä»£æ›¿åŸæœ‰åœºæ™¯ï¼Œä½†æ˜¯éœ€è¦ä½¿ç”¨`useFrame`ä¿®æ”¹`render`æ–¹æ³•ã€‚\n\n```TypeScript\n// å†åŸç”»é¢çš„å·¦ä¸Šè§’ç»˜åˆ¶åœºæ™¯\nexport default () => {\n    const scene = useRef<Scene>();\n    const {\n        size: {left, top, width, height},\n        camera,\n    } = useThree();\n\n    useFrame(({ gl }) => {\n        gl.autoClear = true;\n        gl.setScissor(left, top, width / 2, height / 2);\n        gl.setViewport(left, top, width / 2, height / 2);\n\n        scene.current && gl.render(scene, camera)\n    }, 10);\n\n    return (\n        <scene ref={scene}>\n            <mesh />\n        </scene>\n    );\n}\n```\n\nè¿™é‡Œ`useFrame`çš„ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºå®ƒçš„ä¼˜å…ˆçº§ï¼Œå€¼è¶Šé«˜ï¼Œè¶Šå…ˆæ¸²æŸ“ï¼Œè¿™æ„å‘³ç€æ¯”å®ƒä¼˜å…ˆçº§ä½çš„åœºæ™¯æ¸²æŸ“ä¹‹å‰è¦æŠŠ`gl.autoClear`è®¾ç½®ä¸º`false`ï¼Œä»¥é¿å…è¢«æ¸…é™¤ã€‚\n\n## å…¶å®ƒ\n\nå¦å¤–å¯ä»¥çœ‹çœ‹äº¬ä¸œçš„ä¸€ç¯‡åšå®¢[å‡¹å‡¸å®éªŒå®¤](https://aotu.io/notes/2018/10/18/cannonjs/index.html)ã€‚\n","collection":"blog","data":{"type":"post","category":"fe","tag":["threejs","JavaScript","webGL"],"series":{"slug":"threejs-howto","name":"ç»†å“threejs"}}},{"id":"2020/04/27/threejs.md","slug":"2020/04/27/threejs","body":"\n# threejs ç»†åŒ–-åœ¨ç½‘æ ¼ä¸Šæ¸²æŸ“ï¼Œåœæ­¢æ¸²æŸ“ï¼Œä½¿ç”¨ç‰©ç†å¼•æ“\n\nè¿™æ˜¯ç»†åŒ–äº†è§£ threejs çš„ç¬¬äºŒç¯‡ï¼Œ[ç¬¬ä¸€ç¯‡](/fe/2020/04/21/threejsç»†åŒ–-åˆ›å»ºä¸€ä¸ªmeshã€ä½¿ç”¨åŠ è½½å™¨ã€å¤šä¸ªåœºæ™¯.html)\n\n## åœ¨ç½‘æ ¼ä¸Šæ¸²æŸ“\n\nè¿™é‡Œæœ‰ä¸€ç‚¹ç±»ä¼¼äºä½¿ç”¨å¤šä¸ªåœºæ™¯ï¼Œè®¾æƒ³å¦‚æœæƒ³è¦åšä¸€ä¸ªç±»ä¼¼äºæ°´æ™¶çƒçš„è®¾è®¡ï¼Œæ°´æ™¶çƒæœ‰ä¸€ä¸ª scene1ï¼Œæ°´æ™¶çƒè‡ªå·±åˆåœ¨å¦ä¸€ä¸ª scene0 é‡Œé¢ï¼Œè¿™é‡Œå°±éœ€è¦ä½¿ç”¨ renderTarget æ¸²æŸ“ scene1 åˆ°æ°´æ™¶çƒä¸Šé¢ã€‚\n\nå…ˆåˆ›å»ºä¸€ä¸ª targetã€‚\n\n```typescript\nconst target = new WebGLRenderTarget(width, height);\n```\n\nå†åˆ›å»ºä¸€ä¸ªçƒï¼Œå¹¶ä½¿ç”¨ target ä½œä¸ºææ–™ã€‚\n\n```tsx\nconst ball = () => {\n  return (\n    <mesh name=\"ball\">\n      <sphereBufferGeometry attach=\"geometry\" args={[1, 32, 16]} />\n      <meshPhongMaterial attach=\"material\" map={target.texture} />\n    </mesh>\n  );\n};\n```\n\nç„¶ååˆ›å»º scene1ã€‚\n\n```ts\nconst scene1 = new Scene();\nconst camera = new PerspectiveCamera(75, 1, 0.1, 5, position: [0, 1, 2]);\n\n{\n  const light = new HemisphereLight();\n  scene1.add(light);\n}\n\n{\n  const mesh = new Mesh(\n    new BoxBufferGeometry(1, 1, 1),\n    new MeshPhongMaterial({ color: 0x8844aa }),\n  );\n  scene1.add(mesh);\n}\n```\n\nè²Œä¼¼ react-three-fiber çš„ render å‡½æ•°ä¹Ÿå¯ä»¥æŠŠ JSX æ¸²æŸ“æˆ sceneã€‚ä½†æ˜¯ä½¿ç”¨çš„æ—¶å€™å‘Šè¯‰æˆ‘éœ€è¦åˆ›å»º contextï¼Œéš¾é“æ˜¯è¦ç”¨ React.createContext? æ„Ÿè§‰å‘å¾ˆå¤šï¼Œæ‰€ä»¥æš‚æ—¶æ²¡æœ‰å°è¯•ï¼Œä»¥åå†è¡¥å……è¿™é‡Œã€‚\n\n```tsx\nconst scene = new Scene();\nconst context = createContext();\n\nrender(\n  <>\n    <perspectiveCamera />\n    <hemishpereLight />\n    <mesh>\n      <boxBufferGeometry args={[1, 1, 1]} attach=\"geometry\" />\n      <meshPhongMaterial color={0x8844aa} attach=\"material\" />\n    </mesh>\n  </>,\n  scene,\n  context\n);\n```\n\nå¥½äº†ï¼Œå›åˆ°æ­£é¢˜ï¼Œç°åœ¨éœ€è¦åœ¨ target ä¸Šé¢æ¸²æŸ“ scene1.\n\n```ts\nuseFrame(({ gl }) => {\n  gl.setRenderTarget(target);\n  gl.render(scene1, camera); // è¿™é‡Œçš„cameraæ˜¯scene1é‡Œé¢çš„camera\n  gl.setRenderTarget(null);\n});\n```\n\nå’Œæ¸²æŸ“ä¸¤ä¸ª scene ä¸€æ ·ï¼Œä¸ç®¡æ‰“ç®—æ¸²æŸ“å‡ ä¸ªåœºæ™¯ï¼Œå®é™…çš„æ¸²æŸ“å™¨åªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥æ¸²æŸ“å¥½ target åè¿˜è¦æŠŠè¦æ¸²æŸ“çš„ç›®æ ‡æ¢å›æ¥ã€‚\n\n## åœæ­¢æ¸²æŸ“\n\nreact-three-fiber é»˜è®¤ä¼šä¸€ç›´æ¸²æŸ“æ¯ä¸€å¸§ï¼Œè€Œåœ¨ç½‘é¡µä¸Šï¼Œæˆ‘ä»¬å¾€å¾€ä¸éœ€è¦å®ƒä¸€ç›´è€—è´¹ GPU æ—¶é—´ï¼Œæ¯”å¦‚æ¸²æŸ“å¥½çš„åŠ¨ç”»ï¼Œåªéœ€è¦å®ƒåœ¨ç‰¹æ®Šæ—¶é—´æ‰è¿åŠ¨ï¼Œreact-three-fiber æœ‰ä¸€ä¸ª invalidateFrameloop é€‰é¡¹å¯ä»¥æš‚åœæ¸²æŸ“ã€‚\n\n```tsx\n<Canvas invalidateFrameloop />\n```\n\nå¦å¤–`useThree().invalidate`ä¹Ÿå¯ä»¥æš‚åœæ¸²æŸ“ï¼Œä½†è¿™ä¸ªä¸å¤ªç¨³å®šï¼Œä¸ç¡®å®šæ˜¯ä¸æ˜¯æˆ‘çš„é—®é¢˜ã€‚\n\næ¯”å¦‚åŠ è½½è¿›æ¥ä¸€ä¸ªæ¨¡å‹ï¼Œæƒ³è®©å®ƒåŠ¨ç”»ç»“æŸåå°±åœæ­¢ GPU æ¸²æŸ“ã€‚\n\n```tsx\nconst animate = useMemo(() => new AnimationMixer(obj));\nconst action = useMemo(() => {\n  const act = animate.clipAction(obj.animations[0]);\n  act.setLoop(LoopOnce, 1);\n  act.enabled = true;\n  act.clampedWhenFinished = true;\n  act.play();\n  return act;\n}, []);\n\nconst { invalidate } = useThree();\n\nuseFrame((_, delta) => {\n  animate.update(delta);\n  if (!act.isRunning()) {\n    invalidate();\n  }\n});\n```\n\n## ä½¿ç”¨ç‰©ç†å¼•æ“\n\nç‰©ç†å¼•æ“æ˜¯ä½¿ç”¨ webGL æœ€çˆ½çš„éƒ¨åˆ†ï¼Œä¸»è¦æ˜¯ä¸ç”¨è€ƒè™‘é‚£äº›å…¬å¼ï¼Œè¿™é‡Œç”¨`Cannon.js`æ‰“ä¸ªæ¯”æ–¹ï¼Œï¼ˆæ„ŸåŠ¨å¸¸åœ¨ï¼‰ã€‚\n\né¦–å…ˆåˆ›å»ºä¸–ç•Œï¼Œæ¯”å¦‚åˆ›å»ºä¸€ä¸ª z è½´åŠ é€Ÿåº¦ä¸º 9.82 çš„ä¸–ç•Œï¼Œè¿˜éœ€è¦ NaiveBroadphase åšç¢°æ’æ£€æµ‹ã€‚\n\n```ts\nconst world = new World();\nworld.gravity.set(0, 0, -9.82);\nworld.broadphase = new NaiveBroadphase();\n```\n\næ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ªç‰©ä½“ï¼ŒåŒ…æ‹¬å®ƒçš„å½¢çŠ¶ï¼ˆshapeï¼‰å’Œåœ¨ä¸–ç•Œä¸­çš„ç»†èŠ‚å‚æ•°ï¼ˆbodyï¼‰ã€‚\n\n```ts\nconst shape = new Sphere(1);\nconst body = new Body({ mass: 5, shape });\nworld.add(body);\n```\n\næ¥ä¸‹æ¥è®¾ç½®æ¸²æŸ“çš„æ—¶é—´é—´éš”ã€‚\n\n```ts\nuseFrame(() => world.step(1 / 60)); // å•ä½ç§’\n```\n\nå¥½äº†ï¼Œé‚£ä¹ˆæ€ä¹ˆå’Œ react-three-fiber ç©è€å‘¢ï¼Ÿå…¶å®å¯ä»¥å†™ä¸€ä¸ª[useCannon](https://github.com/gongbaodd/webgl_demos/blob/dev/hooks/useCannon.tsx)ã€‚\n\nä½†æ˜¯è€ƒè™‘åˆ°æœ‰ç°æˆçš„ hooksï¼Œè‡ªå·±å°±ä¸ç”¨å†™è½®å­äº†ï¼Œ[react-spring/use-cannon](https://github.com/react-spring/use-cannon)ï¼Œä»–æ˜¯ç”¨ web worker è·‘çš„ï¼Œæ€§èƒ½è‚¯å®šæ›´å¥½ï¼Œç›´æ¥çœ‹ä¾‹å­å¥½äº†ï¼Œç™½å«–çœŸçˆ½ã€‚\n\n```jsx\nimport { Canvas } from \"react-three-fiber\";\nimport { Physics, usePlane, useBox } from \"use-cannon\";\n\nfunction Plane(props) {\n  const [ref] = usePlane(() => ({ rotation: [-Math.PI / 2, 0, 0], ...props }));\n  return (\n    <mesh ref={ref}>\n      <planeBufferGeometry attach=\"geometry\" args={[100, 100]} />\n    </mesh>\n  );\n}\n\nfunction Cube(props) {\n  const [ref] = useBox(() => ({ mass: 1, position: [0, 5, 0], ...props }));\n  return (\n    <mesh ref={ref}>\n      <boxBufferGeometry attach=\"geometry\" />\n    </mesh>\n  );\n}\n\nReactDOM.render(\n  <Canvas>\n    <Physics>\n      <Plane />\n      <Cube />\n    </Physics>\n  </Canvas>,\n  document.getElementById(\"root\")\n);\n```\n","collection":"blog","data":{"type":"post","category":"fe","tag":["threejs","webgl"],"series":{"slug":"threejs-howto","name":"ç»†å“threejs"}}}]}