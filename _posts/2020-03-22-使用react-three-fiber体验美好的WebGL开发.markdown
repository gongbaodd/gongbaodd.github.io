---
type: post
category: fe
tag:
  - threejs
  - webGL
  - react
series:
  name: ç»†å“threejs
---

# ä½¿ç”¨ react-three-fiber ä½“éªŒç¾å¥½çš„ WebGL å¼€å‘

ä½¿ç”¨ threejs å¼€å‘ webGL åº”ç”¨åº”è¯¥æ˜¯å‡ ä¹æ¯ä¸ªå‰ç«¯å·¥ç¨‹å¸ˆæƒ³è¦åšçš„äº‹å„¿ï¼Œç„¶è€Œè™½ç„¶å¯¹æ¯”äºåŸç”Ÿ WebGL å¼€å‘æ¥è¯´ï¼Œthreejs å·²ç»åšäº†å¾ˆå¤šï¼Œä½†æ˜¯ç›¸å¯¹äºç°ä»£çš„ä¸€äº›å‰ç«¯æ¡†æ¶ã€‚threejs è¿˜ç¨æ˜¾ä¸è¶³ã€‚é’ˆå¯¹è¿™äº›ä¸è¶³ï¼Œå¾®è½¯å¼€å‘äº†[Babylon.js](https://www.babylonjs.com/)ï¼Œç»™ threejs é‡èº«å®šåˆ¶äº†ä¸€ä¸ªèŠ‚ç‚¹ç¼–è¾‘å™¨ï¼Œå¦‚æœåšè¿‡ blender æˆ–è€… unity çš„åŒå­¦ï¼Œå¯¹äºèŠ‚ç‚¹ç¼–è¾‘å™¨è‚¯å®šä¸ä¼šé™Œç”Ÿï¼Œä½†å¯¹æˆ‘æœ¬äººæ¥è¯´è¿˜æ˜¯æ²¡æœ‰è§¦ç¢°åˆ° G ç‚¹ã€‚

## æè¿°ç»„ä»¶å…³ç³»çš„é‡è¦æ€§

æœ¬äººè§‰å¾—ï¼Œå¯¹äºå‰ç«¯å¼€å‘æ¥è¯´ï¼Œæä¾›ä¸€ä¸ªèƒ½å¤Ÿå‡†ç¡®æè¿°ç»„ä»¶å’Œç»„ä»¶ç»“æ„å…³ç³»çš„è¯­è¨€ï¼ˆDSLï¼‰æ˜¯è‡³å…³é‡è¦çš„ï¼Œå¦‚ HTML ä¹‹äº web å¼€å‘ï¼Œxml ä¹‹äºå®‰å“å¼€å‘ã€‚è¿™äº› DSL èƒ½å¤Ÿä»¥æœ€ç›´è§‚çš„æ–¹å¼è¡¨è¾¾é¡µé¢å°†ä¼šå±•ç¤ºä»€ä¹ˆï¼Œå°±ä»å¼€å‘çš„è§’åº¦ä¸Šæ¥è¯´ï¼Œæˆ–è®¸å…¥é—¨ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œæ¯•ç«Ÿè¦å¤„ç†å¾ˆå¤šæ–‡ä»¶ã€‚ä½†æ˜¯ç»´æŠ¤èµ·æ¥å´å¼‚å¸¸çš„è½»æ¾ï¼Œå°±æ˜¯å‰é¢æåˆ°çš„åŸå› ï¼Œç›´è§‚ã€‚å½“ç„¶å› ä¸º JavaScript è·Ÿ HTML çš„äº¤äº’æœ‰å¾ˆå¤§çš„æ€§èƒ½ç¼ºé™·ã€‚æ‰€ä»¥ç»™å¾ˆå¤šæ¨¡æ¿è¯­è¨€æä¾›äº†æœºä¼šã€‚æ¯”å¦‚ mustache è¿˜æœ‰ react çš„ JSXã€‚åœ¨å®‰å“ä¹Ÿèƒ½çœ‹åˆ° anko åœ¨ kotlin ç¤¾åŒºå…´èµ·ï¼Œä½†æ˜¯ä»…ä»…ä¸€å¹´å°±æ²¡æœ‰æ›´å¤šäººä½¿ç”¨äº†ï¼Œä¸ªäººä½“éªŒï¼Œåœ¨ Android studio ä¸­ä½¿ç”¨ xml å’Œ anko å¼€å‘ä½“éªŒå·®è·å¹¶ä¸å¤§ï¼Œæœ‰æ—¶å€™ xml ç”šè‡³å ä¼˜ï¼Œä¹Ÿè®¸è¿™å°±æ˜¯åŸå› ä¹‹ä¸€äº†å§ã€‚

å‡ å¹´å‰æˆ‘ç¿»æŸ¥äº†å¾ˆå¤šæ¡†æ¶ï¼Œè€å®è¯´å¯èƒ½æ›´å¤šäººå¹¶æ²¡æœ‰æŠŠç»“æ„æè¿°æ”¾åœ¨å¦‚æˆ‘æƒ³çš„ä½ç½®ä¸Šï¼Œå“ªæ€•è¿ä¸ª JSON çš„æ–¹æ¡ˆéƒ½æ²¡æœ‰ã€‚ä½†æ˜¯çš„ç¡®æœ‰[aframejs](https://aframe.io/)è¿™ç§ç›´æ¥ç”¨ HTML ç®¡ç† canvas ä¸­å…ƒç´ å…³ç³»çš„åº“ï¼Œå¯æƒœå®ƒæ›´å…³æ³¨äº VR å¼€å‘ï¼Œè€Œæˆ‘æ›´å¸Œæœ› WebGL èƒ½å¤Ÿæˆä¸ºè¯¸å¦‚å›¾ä¹¦æ³¨è§£ä¸€æ ·çš„å·¥å…·ï¼Œå½“ç„¶è¿™ç§ä¸“æ³¨äºä¸€ä¸ªæ–¹é¢çš„åšæ³•æˆ–è®¸æ˜¯æ­£ç¡®çš„ï¼Œæ¯•ç«Ÿèƒ½å¤Ÿæ±‡èšä¸€ä¸ªå°åœˆçš„å¼€å‘è€…ï¼Œä¹Ÿä¸ä¼šæœ‰å¾ˆå¤šæµå¤±ã€‚

## ç”¨ JSX å¼€å‘ WebGL

ä»Šå¹´è¿æ°”å°±å¥½å¤šäº†ï¼Œreact-reconciler ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿç›´æ¥æ¥ç®¡ç»„ä»¶çš„ render å‡½æ•°ï¼Œè€Œ react-hooks åœ¨å¼€å‘ä½“éªŒä¸Šå®Œç¾è¶…å‡ºç°æœ‰æ¡†æ¶ï¼Œ[react-babylonjs](https://github.com/brianzinn/react-babylonJS) å’Œ [react-three-fiber](https://github.com/react-spring/react-three-fiber) åº”è¿è€Œç”Ÿã€‚æˆ‘åŒæ—¶è¯•ç”¨äº†è¿™ä¸¤ä¸ªæ¡†æ¶ï¼Œç®€å•æ¥è¯´ï¼Œreact-three-fiber æ›´åŠ æˆç†Ÿäº›ï¼Œå¯¹ tTypeScript çš„æ”¯æŒæ›´å¥½ï¼Œè€Œ react-babylonjs å¼€å‘çš„æ—¶å€™å¾€å¾€ä¼šå› ä¸ºå¤„ç†ç±»å‹è€Œè´¹å¿ƒï¼Œæœ€ååˆä¸å¾—ä¸ä½¿ç”¨ JavaScript å¼€å‘ã€‚

## æ€ä¹ˆä½¿ç”¨ react-three-fiber

react-three-fiber çš„[å®˜æ–¹æ–‡æ¡£é“¾æ¥](https://inspiring-wiles-b4ffe0.netlify.com/)æè¿°å¾ˆè¯¦ç»†ï¼Œå»ºè®®è¯¦è¯»ã€‚å¦å¤– threejs å®˜æ–¹æ¥é“¾æ¥çš„[threejs fundamentals](https://threejsfundamentals.org/)æœ‰æ—¶é—´ä¹Ÿå¯ä»¥æ‹¿æ¥è¯»è¯»ã€‚

å¦‚æœæƒ³æŠŠåŸæ¥çš„ threejs æ¨¡å—è¿ç§»åˆ° react æ¨¡å—ï¼Œåªéœ€è¦ä½¿ç”¨ä¸€å±‚ primitive åŒ…è£…å³å¯ã€‚æ¯ä¸ªæ‹¥æœ‰ set å’Œ get çš„å‚æ•°éƒ½å¯ä»¥ä½œä¸º props çš„æˆå‘˜ï¼Œæ„é€ å™¨å‚æ•°åˆ™æ˜¯`props.args: any[]`ç±»å‹ã€‚

```JavaScript
const grid = new GridHelper(2000, 20, 0x000000, 0x0000000);
(grid.material as Material).opacity = 0.2;
(grid.material as Material).transparent = true;

const Grid = () => {
  useFrame(({ scene }) => {
    if (!scene.fog) {
      const fog = new Fog(0xa0a0a0, 200, 800);
      scene.fog = fog;
    }
  });

  return <primitive object={grid}></primitive>;
};

```

## è°ƒè¯•å·¥å…·

è¿™ç‚¹ babylonjs è¦å¥½å¾—å¤šï¼Œä¸€ä¸ªèŠ‚ç‚¹ç¼–è¾‘å™¨ç§’æ€ä¸€åˆ‡ï¼Œä½†æ˜¯ threejs è¿˜æœ‰ä¸€ä¸ªã€Œå¤Ÿç”¨ã€çš„[threejs inspector](https://chrome.google.com/webstore/detail/threejs-inspector/dnhjfclbfhcbcdfpjaeacomhbdfjbebi?hl=en)ã€‚

ä½¿ç”¨æ—¶éœ€è¦æŠŠä½ çš„ scene å’Œ THREE æ¨¡å—æš´éœ²ç»™ window ä½œç”¨åŸŸã€‚

```JavaScript
window.scene = scene;
window.THREE = THREE;
```

ç„¶ååˆ·æ–°æµè§ˆå™¨å°±å¯ä»¥åœ¨åœºæ™¯æ·»åŠ å…‰æºï¼ŒæŸ¥çœ‹èŠ‚ç‚¹ç­‰æ“ä½œäº†ã€‚

## æç¤º

å› ä¸º threejs åŠå…¶æ¨¡å—æœ¬èº«ä¸æ˜¯ç¼–è¯‘å¥½çš„ ES5ï¼Œåœ¨ nextjs ä¸­ä¸€å®šè®°å¾—ä½¿ç”¨`next-transpile-modules`ç¼–è¯‘ï¼Œå½“ç„¶å³ä½¿å·²ç»å®Œç¾é€‚é… ES5ï¼Œåœ¨ IE11 çš„å±•ç¤ºä¹Ÿä¸æ˜¯å¾ˆä¹è§‚ ğŸ˜…ã€‚
